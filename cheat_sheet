docker commands
stop all containers:
  docker stop $(docker ps -a -q)
remove all containers
  docker rm $(docker ps -a -q)
remove all images:
  docker rmi $(docker images -a -q)
enter container <containerid>
  docker exec -it <containerid> /bin/sh

all commands:
docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)
docker rmi $(docker images -a -q)

Fungerande upps√§ttning:
  daysofrum:
    docker run -d \
          --name daysofrum \
          --expose 49260 \
          --network="nginx-proxy" \
          -e VIRTUAL_HOST=daysofrum.ropr.se \
          bandmask/daysofrum:amd64
  web:
    docker run -d \
          --name web \
          --expose 49160 \
          --network="nginx-proxy" \
          -e VIRTUAL_HOST=ropr.se \
          bandmask/web:amd64

  registry
    docker run -d \
          --restart=always \
          --name registry \
          -v
  nginx:
    docker run -d \
          -p 443:443 \
          -p 80:80 \
          --name nginx \
          --network="nginx-proxy" \
          -v /var/run/docker.sock:/tmp/docker.sock \
          -v /var/nginx/conf:/etc/nginx:ro \
          -v /etc/letsencrypt/live/ropr.se/fullchain.pem:/etc/ssl/fullchain.pem \
          -v /etc/letsencrypt/live/ropr.se/privkey.pem:/etc/ssl/privkey.pem \
          -P nginx:1.15.6-alpine


certbot:
  certificates:
    sudo certbot certonly --standalone -d ropr.se -d www.ropr.se -d daysofrum.ropr.se -d

  expand:
    sudo certbot certonly --standalone --cert-name ropr.se -d ropr.se -d www.ropr.se -d daysofrum.ropr.se -d auth.ropr.se -d registry.ropr.se

  renew:
    sudo certbot renew --dry-run --pre-hook "sudo docker stop nginx" --post-hook "sudo docker start nginx"


nginx.conf:
# location: /var/nginx/conf
events { }

error_log /var/log/nginx/error.log warn;

http {
  server {
    server_name _;

    listen 80 default_server;
    listen [::]:80 default_server;

    location / {
      return 301 https://$host$request_uri;
    }
  }

  server {
    server_name .ropr.se;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    ssl_certificate /etc/ssl/fullchain.pem;
    ssl_certificate_key /etc/ssl/privkey.pem;

    location / {
      proxy_pass http://web:49160;
    }
  }

  server {
    server_name daysofrum.ropr.se;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    ssl_certificate /etc/ssl/fullchain.pem;
    ssl_certificate_key /etc/ssl/privkey.pem;

    location / {
      proxy_pass http://daysofrum:49260;
    }
  }
}
